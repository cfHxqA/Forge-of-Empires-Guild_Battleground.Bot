// ==UserScript==
// @name        BotNix - FoE-Helper.Bot
// @namespace   BotNix.FoE_Helper
// @version     4.1.0.0
//
// @author      cfHxqA
// @copyright   2013 - 2025 (C) cfHxqA
//
// @downloadURL https://raw.githubusercontent.com/cfHxqA/Forge-of-Empires-Helper.Bot/refs/heads/main/tampermonkey.user.js
// @updateURL   https://raw.githubusercontent.com/cfHxqA/Forge-of-Empires-Helper.Bot/refs/heads/main/tampermonkey.user.js
//
// @require     https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js
// @require     https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js
//
// @match       *://*.forgeofempires.com/game/index*
// @match       *://*.forgeofempires.com/socket/
//
// @grant       GM.deleteValue
// @grant       GM.getValue
// @grant       GM.setValue
// @grant       GM.cookie
// @grant       GM.xmlHttpRequest
// @grant       unsafeWindow
//
// @run-at      document-start
// ==/UserScript==
let DebugEnabled = false;

function _0x5c96(_0x27bf9d,_0x5ecf02){const _0x3b9f49=_0x3b9f();return _0x5c96=function(_0x5c96e2,_0x369f32){_0x5c96e2=_0x5c96e2-0x68;let _0x3902f2=_0x3b9f49[_0x5c96e2];return _0x3902f2;},_0x5c96(_0x27bf9d,_0x5ecf02);}function _0x3b9f(){const _0x68af08=['$1(\x22X-Client-Identification\x22,\x20\x22','random','No\x20jQuery!\x20Aborting!','ajax','setValue','list','2982975nJpGIv','\x27-settings\x20object\x20created.','response','12770856oniKek','startPreloader','\x27-settings\x20object\x20written.','DEBUG\x20|\x20Download\x20game-source\x20and\x20prepare\x20it...','createElement','innerHTML','ERROR\x20|\x20Failed\x20while\x20patching\x20source-code.\x20Please\x20wait...\x20(','INFO\x20|\x20Necessary\x20changes\x20have\x20been\x20successfully\x20applied!','prototype','2948112NnFFjO','DEBUG\x20|\x20Check\x20Tampermonkey\x20settings\x20and\x20read\x20out\x20data...','text/javascript','DOMContentLoaded','An\x20error\x20occurred\x20while\x20patching\x20the\x20game\x20file.','956336eOZpYJ','8eikvzz','DEBUG\x20|\x20\x27','initSentry(getBuildConfiguration());','slice','hasOwnProperty','INFO\x20|\x20Validate\x20that\x20the\x20necessary\x20changes\x20have\x20been\x20applied...','$1\x27ws://127.0.0.1/socket/\x27,','floor','url','onGameLoaded','1122651eAEWMh','split','replace','onTranslationsLoaded','cRetry','log','join','DEBUG\x20|','[BotNix\x20-\x20FoE-Helper.Bot][','BotNix_FoE_Helper_','reload','DEBUG\x20|\x20Check\x20Game-Source\x20and\x20patch...','location','toString','http://127.0.0.1/game/','http:/127.0.0.1/','xmlHttpRequest','sid','match','HEAD','call','An\x20error\x20occurred\x20while\x20apply\x20the\x20game-patch.','YYYY-MM-DD\x20HH:mm:ss','assign','length','1586119XWcaDq','type','2183136uXezdW','gettextCatalog','GET','An\x20error\x20occurred\x20while\x20reading\x20the\x20game-file.','includes','host','ERROR\x20|\x20Backend-Server\x20is\x20NOT\x20AVAILABLE!\x20Please\x20start\x20applicaton\x20as\x20administrator\x20for\x20usage.','format'];_0x3b9f=function(){return _0x68af08;};return _0x3b9f();}const _0x1aef95=_0x5c96;(function(_0x1f1ebb,_0x1b5408){const _0x2fcc44=_0x5c96,_0x57e144=_0x1f1ebb();while(!![]){try{const _0x242bac=parseInt(_0x2fcc44(0x86))/0x1+parseInt(_0x2fcc44(0xa8))/0x2*(parseInt(_0x2fcc44(0x6d))/0x3)+parseInt(_0x2fcc44(0xa2))/0x4+-parseInt(_0x2fcc44(0x96))/0x5+-parseInt(_0x2fcc44(0x88))/0x6+-parseInt(_0x2fcc44(0x99))/0x7+-parseInt(_0x2fcc44(0xa7))/0x8;if(_0x242bac===_0x1b5408)break;else _0x57e144['push'](_0x57e144['shift']());}catch(_0x4b5f55){_0x57e144['push'](_0x57e144['shift']());}}}(_0x3b9f,0xdf89e));if('undefined'==typeof jQuery)throw new(_0x1aef95(0x92))();(async function(){'use strict';const _0x5724d6=_0x1aef95;let _0x279965=(_0x220969,_0x3b3729)=>{const _0x4ce04e=_0x5c96;if(!_0x3b3729&&!_0x220969[_0x4ce04e(0x8c)](_0x4ce04e(0x74))||_0x3b3729)console[_0x4ce04e(0x72)](_0x4ce04e(0x75)+moment(new Date())[_0x4ce04e(0x8f)](_0x4ce04e(0x83))+']\x20'+_0x220969);};async function _0x11e0b4(){const _0x96f77f=_0x5c96;let _0x29cafd=document[_0x96f77f(0x79)]['host'][_0x96f77f(0x6e)]('.')[_0x96f77f(0xab)](0x0,0x1)['join'](),_0x3def47='BotNix_FoE_Helper_'+_0x29cafd,_0x441eff=await GM['getValue'](_0x3def47,null);if(_0x441eff==null||Object[_0x96f77f(0xa1)][_0x96f77f(0x7a)][_0x96f77f(0x81)](_0x441eff)['slice'](0x8)[_0x96f77f(0xab)](0x0,-0x1)['toLowerCase']()!='object')return await GM['setValue'](_0x96f77f(0x76)+_0x29cafd,{}),_0x279965('DEBUG\x20|\x20\x27'+_0x29cafd+_0x96f77f(0x97),DebugEnabled),await _0x11e0b4();return _0x279965(_0x96f77f(0xa9)+_0x29cafd+'\x27-settings\x20object\x20read\x20out.',DebugEnabled),_0x441eff;}async function _0xa550a6(_0x5afb83){const _0x35ce68=_0x5c96;let _0x4fd105=document[_0x35ce68(0x79)][_0x35ce68(0x8d)][_0x35ce68(0x6e)]('.')[_0x35ce68(0xab)](0x0,0x1)[_0x35ce68(0x73)](),_0x2d6558=_0x35ce68(0x76)+_0x4fd105;await GM[_0x35ce68(0x94)](_0x35ce68(0x76)+_0x4fd105,_0x5afb83),_0x279965('DEBUG\x20|\x20\x27'+_0x4fd105+_0x35ce68(0x9b),DebugEnabled);}let _0x43c8f3=await _0x11e0b4();function _0x1ca679(_0xd4cd6b){const _0x451741=_0x5c96;try{const _0x583b85=document[_0x451741(0x9d)]('script');_0x583b85[_0x451741(0x87)]=_0x451741(0xa4),_0x583b85[_0x451741(0x9e)]=_0xd4cd6b,document['body']['append'](_0x583b85);let _0x59a020=unsafeWindow[_0x451741(0x6c)][_0x451741(0x7a)]();_0x59a020=_0x59a020[_0x451741(0x6f)](/https:\/\/\w+\.forgeofempires\.com\/game\//,_0x451741(0x7b)),_0x59a020=_0x59a020['replace'](/(socketGatewayUrl: ).+socket\/',/,_0x451741(0x69)),_0x59a020=_0x59a020[_0x451741(0x6f)](_0x451741(0xaa),''),unsafeWindow[_0x451741(0x6c)]=function(){},eval(''+_0x59a020[_0x451741(0x7f)](/onGameLoaded\(\) {(.*)}/s)[0x1]),_0x279965(_0x451741(0xa0));}catch{throw _0x451741(0x82);}}function _0x8c9a3(_0x5c4c79,_0x5c50b2){const _0x52329b=_0x5c96;return _0x5c4c79=_0x5c4c79['replace'](/(new .+)\("Content-Type","application\/json"\)/,_0x52329b(0x90)+_0x5c50b2+'\x22)'),_0x5c4c79;}async function _0x2be173(){const _0x2fb2aa=_0x5c96;try{let _0x59df8f=unsafeWindow[_0x2fb2aa(0x70)][_0x2fb2aa(0x7a)](),_0x1d4d20=_0x59df8f['match'](/https:\/\/\w+\.innogamescdn\.com\/cache\/ForgeHX-\w+\.js/);if(_0x1d4d20?.[_0x2fb2aa(0x85)]==0x0)throw _0x2fb2aa(0x8b);unsafeWindow[_0x2fb2aa(0x70)]=async function(_0x3acd70){const _0x17d8f5=_0x2fb2aa;unsafeWindow[_0x17d8f5(0x89)]=_0x3acd70;function _0x226ead(_0x348a13){return new Promise((_0x35683e,_0x5bb34e)=>{const _0x275430=_0x5c96;GM[_0x275430(0x7d)](Object[_0x275430(0x84)]({'method':_0x275430(0x8a)},_0x348a13[_0x275430(0x6b)]?_0x348a13:{'url':_0x348a13},{'onload':_0x5ede68=>_0x35683e(_0x5ede68[_0x275430(0x98)]),'onerror':_0x5bb34e,'ontimeout':_0x5bb34e}));});}_0x279965(_0x17d8f5(0x9c),DebugEnabled);let _0x355f91=await _0x226ead(_0x1d4d20[0x0]);if(_0x355f91?.['length']==0x0)throw'An\x20error\x20occurred\x20while\x20reading\x20the\x20game-source.';_0x279965(_0x17d8f5(0xa3),DebugEnabled);let _0x27721d=(await GM['cookie'][_0x17d8f5(0x95)]({'domain':location[_0x17d8f5(0x8d)],'name':_0x17d8f5(0x7e)}))?.[0x0]?.['value'];if(_0x27721d==undefined||_0x27721d?.[_0x17d8f5(0x85)]==0x0)throw'Please\x20check\x20your\x20settings\x20in\x20\x27Tampermonkey\x27!\x0aHere\x20is\x20a\x20guide\x20to\x20find\x20the\x20way\x20there\x20and\x20set\x20it\x20up\x20correctly:\x0a\x0aSettings\x20->\x20Configuration\x20mode\x20(Expert)\x20->\x20Security\x20->\x20Cookie\x20access\x20by\x20user\x20scripts:\x20ALL';_0x279965(_0x17d8f5(0x78),DebugEnabled),_0x355f91=_0x8c9a3(_0x355f91,_0x27721d),_0x1ca679(_0x355f91);};}catch{if(!_0x43c8f3[_0x2fb2aa(0xac)](_0x2fb2aa(0x71)))_0x43c8f3[_0x2fb2aa(0x71)]=0x1;else{if(_0x43c8f3[_0x2fb2aa(0x71)]<0x3)_0x43c8f3[_0x2fb2aa(0x71)]++;}if(_0x43c8f3[_0x2fb2aa(0x71)]<0x3){_0xa550a6(_0x43c8f3);let _0x5df6bd=Math[_0x2fb2aa(0x6a)](Math[_0x2fb2aa(0x91)]()*(0x1f4-0x96+0x1)+0x96)*0xa;_0x279965(_0x2fb2aa(0x9f)+_0x5df6bd/0x3e8+'s)',DebugEnabled),await new Promise(_0x1962bf=>setTimeout(_0x1962bf,_0x5df6bd)),unsafeWindow[_0x2fb2aa(0x79)][_0x2fb2aa(0x77)]();}else{delete _0x43c8f3[_0x2fb2aa(0x71)],_0xa550a6(_0x43c8f3);throw _0x2fb2aa(0xa6);}}}try{document['addEventListener'](_0x5724d6(0xa5),()=>{const _0x165b56=_0x5724d6;let _0x1e6bb2=unsafeWindow['startPreloader'];unsafeWindow[_0x165b56(0x9a)]=async function(){const _0x2ff8e2=_0x165b56;try{await $[_0x2ff8e2(0x93)]({'type':_0x2ff8e2(0x80),'timeout':0x3e8,'url':_0x2ff8e2(0x7c),'statusCode':{0x0:()=>_0x279965(_0x2ff8e2(0x8e))}}),_0x279965(_0x2ff8e2(0x68)),await _0x2be173(),_0x1e6bb2();}catch{_0x1e6bb2();}};});}catch{_0x279965('ERROR\x20|\x20Backend-Server\x20is\x20NOT\x20AVAILABLE!\x20Please\x20start\x20applicaton\x20as\x20administrator\x20for\x20usage.');}}());